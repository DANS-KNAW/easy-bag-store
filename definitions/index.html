



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-4.6.3">
    
    
      
        <title>Definitions - easy-bag-store</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.44877490.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.b81a0a10.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Glegoo:300,400,400i,700|Ubuntu+Mono&display=swap">
        <style>.body-type,body,input{font-family:"Open Sans",sans-serif}.head-type,h1,h2,h3,h4,h5{font-family:"Glegoo",serif}.code-type,code,kbd,pre{font-family:"Ubuntu Mono",monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#definitions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      

<header class="md-header" data-md-component="header">

  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dans.knaw.nl/en" title="Data Archiving and Networked Services (DANS)" class="md-header-nav__button md-logo">
          <img src="../assets/images/DANS.gif" height="50">
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="easy-bag-store" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title head-type" data-md-component="title">
          
            <span class="md-header-nav__topic">
              easy-bag-store
              
            </span>
            <span class="md-header-nav__topic">
              
                Definitions
              
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/DANS-KNAW/easy-bag-store/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    DANS-KNAW/easy-bag-store
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title head-type md-nav__title--site" for="__drawer">
    <a href=".." title="easy-bag-store" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    easy-bag-store
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/DANS-KNAW/easy-bag-store/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    DANS-KNAW/easy-bag-store
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Manual" class="md-nav__link head-type">
      Manual
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active head-type" for="__toc">
        Definitions
      </label>
    
    <a href="./" title="Definitions" class="md-nav__link md-nav__link--active head-type">
      Definitions
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title head-type" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link head-type">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link head-type">
    Summary
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-two-sentences" title="In two sentences" class="md-nav__link head-type">
    In two sentences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-one-picture" title="In one picture" class="md-nav__link head-type">
    In one picture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remarks" title="Remarks" class="md-nav__link head-type">
    Remarks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objects-attributes" title="Objects &amp; attributes" class="md-nav__link head-type">
    Objects &amp; attributes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bagstore" title="BagStore" class="md-nav__link head-type">
    BagStore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bag" title="Bag" class="md-nav__link head-type">
    Bag
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#virtually-valid" title="virtually-valid" class="md-nav__link head-type">
    virtually-valid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inactive" title="(in)active" class="md-nav__link head-type">
    (in)active
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#item" title="Item" class="md-nav__link head-type">
    Item
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#item-id" title="item-id" class="md-nav__link head-type">
    item-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#item-location" title="item-location" class="md-nav__link head-type">
    item-location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-data-location" title="file-data-location" class="md-nav__link head-type">
    file-data-location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-file-uri" title="local-file-uri" class="md-nav__link head-type">
    local-file-uri
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations" title="Operations" class="md-nav__link head-type">
    Operations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extension" title="Extension" class="md-nav__link head-type">
    Extension
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compatibility-with-archival-resource-keys" title="Compatibility with Archival Resource Keys" class="md-nav__link head-type">
    Compatibility with Archival Resource Keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minting-an-ark-using-an-item-id" title="Minting an ARK using an item-id" class="md-nav__link head-type">
    Minting an ARK using an item-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-an-item-id-from-an-ark" title="Getting an item-id from an ARK" class="md-nav__link head-type">
    Getting an item-id from an ARK
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-considerations" title="Technical considerations" class="md-nav__link head-type">
    Technical considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slashing-the-bag-id" title="Slashing the bag-id" class="md-nav__link head-type">
    Slashing the bag-id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tutorial/" title="Tutorial" class="md-nav__link head-type">
      Tutorial
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../to-api/" title="HTTP API" class="md-nav__link head-type">
      HTTP API
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title head-type" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link head-type">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link head-type">
    Summary
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-two-sentences" title="In two sentences" class="md-nav__link head-type">
    In two sentences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-one-picture" title="In one picture" class="md-nav__link head-type">
    In one picture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remarks" title="Remarks" class="md-nav__link head-type">
    Remarks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objects-attributes" title="Objects &amp; attributes" class="md-nav__link head-type">
    Objects &amp; attributes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bagstore" title="BagStore" class="md-nav__link head-type">
    BagStore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bag" title="Bag" class="md-nav__link head-type">
    Bag
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#virtually-valid" title="virtually-valid" class="md-nav__link head-type">
    virtually-valid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inactive" title="(in)active" class="md-nav__link head-type">
    (in)active
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#item" title="Item" class="md-nav__link head-type">
    Item
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#item-id" title="item-id" class="md-nav__link head-type">
    item-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#item-location" title="item-location" class="md-nav__link head-type">
    item-location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-data-location" title="file-data-location" class="md-nav__link head-type">
    file-data-location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-file-uri" title="local-file-uri" class="md-nav__link head-type">
    local-file-uri
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations" title="Operations" class="md-nav__link head-type">
    Operations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extension" title="Extension" class="md-nav__link head-type">
    Extension
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compatibility-with-archival-resource-keys" title="Compatibility with Archival Resource Keys" class="md-nav__link head-type">
    Compatibility with Archival Resource Keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minting-an-ark-using-an-item-id" title="Minting an ARK using an item-id" class="md-nav__link head-type">
    Minting an ARK using an item-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-an-item-id-from-an-ark" title="Getting an item-id from an ARK" class="md-nav__link head-type">
    Getting an item-id from an ARK
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-considerations" title="Technical considerations" class="md-nav__link head-type">
    Technical considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slashing-the-bag-id" title="Slashing the bag-id" class="md-nav__link head-type">
    Slashing the bag-id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/DANS-KNAW/easy-bag-store/edit/master/docs/definitions.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="definitions">Definitions<a class="headerlink" href="#definitions" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>A bag store is a way to store and identify data packages following a few very simple rules. This 
document describes the bag store concept in a terse and quasi-formal manner. See the <a href="../tutorial/">tutorial</a> 
for a more elaborate, hands-on introduction.</p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<h3 id="in-two-sentences">In two sentences<a class="headerlink" href="#in-two-sentences" title="Permanent link">&para;</a></h3>
<p>A <a href="#bagstore"><strong>BagStore</strong></a> is a collection of immutable, <a href="#bag"><strong>virtually-valid Bag</strong></a>s stored under 
a common <a href="#bagstore"><strong>base-dir</strong></a>. Each <a href="#item"><strong>Item</strong></a> in the BagStore has an <a href="#item-id"><strong>item-id</strong></a>
and an <a href="#item-location"><strong>item-location</strong></a> with simple mapping rules to translate between them. </p>
<h3 id="in-one-picture">In one picture<a class="headerlink" href="#in-one-picture" title="Permanent link">&para;</a></h3>
<p><img alt="bag-store" src="../img/bag-store.svg" />   </p>
<h4 id="remarks">Remarks<a class="headerlink" href="#remarks" title="Permanent link">&para;</a></h4>
<ul>
<li>The notation <code>bag-id &lt; item-id</code> means that a bag-id is a special kind of item-id.</li>
<li>A slash preceding an attribute signifies that it is derivable from other attributes.</li>
</ul>
<h2 id="objects-attributes">Objects &amp; attributes<a class="headerlink" href="#objects-attributes" title="Permanent link">&para;</a></h2>
<h3 id="bagstore">BagStore<a class="headerlink" href="#bagstore" title="Permanent link">&para;</a></h3>
<p>The collection of Bags stored under a common base directory (<strong>base-dir</strong>). It uses a single <strong>slash-pattern</strong>
(see <a href="#item-location">item-location</a>).</p>
<h3 id="bag">Bag<a class="headerlink" href="#bag" title="Permanent link">&para;</a></h3>
<p>The elements of the BagStore are Bags, i.e. directories or archive files conforming to the <a href="https://tools.ietf.org/html/draft-kunze-bagit">BagIt</a> 
specifications. The Bags must be virtually-valid. They may be active or inactive.</p>
<h4 id="virtually-valid">virtually-valid<a class="headerlink" href="#virtually-valid" title="Permanent link">&para;</a></h4>
<p>A Bag is virtually-valid if:</p>
<ul>
<li>it is <a href="https://tools.ietf.org/html/draft-kunze-bagit#section-3">valid</a>, or</li>
<li>it is incomplete, but contains a [<code>fetch.txt</code>] file and can be made valid by fetching the files
  listed in it and removing <code>fetch.txt</code> and its corresponding checksums from the Bag. If 
  <a href="#local-file-uri">local-file-uris</a> are used, they must reference RegularFiles in the same BagStore.</li>
</ul>
<h4 id="inactive">(in)active<a class="headerlink" href="#inactive" title="Permanent link">&para;</a></h4>
<p>A Bag in a BagStore is inactive if its name starts with a full stop character. It is active otherwise.</p>
<h3 id="item">Item<a class="headerlink" href="#item" title="Permanent link">&para;</a></h3>
<p>An <strong>Item</strong> is a Bag, or a <strong>File</strong> in a Bag. A File is either a <strong>RegularFile</strong> or a <strong>Directory</strong>. 
Each Item has an <strong>item-id</strong>. </p>
<h4 id="item-id">item-id<a class="headerlink" href="#item-id" title="Permanent link">&para;</a></h4>
<p>The item-ids are defined as follows:</p>
<ul>
<li><strong>bag-id</strong> = <code>&lt;uuid&gt;</code>, that is a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> represented as lowercase hexadecimal digits and hyphens, following
  the layout described in <a href="https://tools.ietf.org/html/rfc4122#section-3">RFC4122</a>.</li>
<li>
<p><strong>file-id</strong> = <code>&lt;bag-id&gt;/percent-encoded-segments(&lt;path-in-bag&gt;)</code>, where:</p>
</li>
<li>
<p><strong>percent-encoded-segments</strong> means that to each path segment <a href="https://tools.ietf.org/html/rfc3986#section-2.1">percent-encoding</a> is applied to 
    all characters except (English) alphanumericals and the underscore character. When percent-encoding a
    character, the <a href="https://tools.ietf.org/html/rfc3629">UTF-8</a> representation must be used as input.</p>
</li>
<li>
<p><strong>path-in-bag</strong> is the relative path of the File in the bag, after <code>fetch.txt</code> has been resolved.</p>
</li>
</ul>
<h4 id="item-location">item-location<a class="headerlink" href="#item-location" title="Permanent link">&para;</a></h4>
<p>The item-locations are defined as follows:</p>
<ul>
<li>
<p><strong>bag-location</strong> = <code>&lt;base-dir&gt;/slashed(&lt;uuid&gt;)/[.]&lt;bag&gt;</code>, where:</p>
<ul>
<li>
<p><strong>slashed</strong> means that the UUID is stripped of hyphens and then subdivided into several groups 
  of characters, with the slash as separator, forming a file path. The number of slashes to insert 
  and where to insert them is specified by the <strong>slash-pattern</strong>.</p>
</li>
<li>
<p><strong>bag</strong> the name of the Bag. For an unserialized Bag this is the name of the base directory, for a serialized
  Bag the name of the archive file containing it, including the extension, such as <code>.tar</code> or <code>.7z</code>. The
  base directory of the bag must always be the same as the base name of the serialized bag.</p>
</li>
<li>
<p>the <strong>dot</strong>, if present, means that the bag is <a href="#inactive">inactive</a>.</p>
</li>
</ul>
</li>
<li>
<p><strong>file-location</strong> = <code>&lt;bag-location&gt;/&lt;path-in-bag&gt;</code>.</p>
</li>
</ul>
<h4 id="file-data-location">file-data-location<a class="headerlink" href="#file-data-location" title="Permanent link">&para;</a></h4>
<p>The file-data-location is the location where the RegularFile's data is actually stored (in the
case of an unserialized Bag), or where it <em>would</em> be stored if a serialized Bag were unserialized and
completed in-place. (Note the conditional, however, as actually performing unserialization and completion
in-place is not permitted.) </p>
<ul>
<li>
<p><strong>file-data-location</strong> = <code>completed(unserialized(&lt;bag-location&gt;))/path-in-bag</code>, where:</p>
<ul>
<li><strong>unserialized</strong> means the Bag after unserializing it in-place.</li>
<li><strong>completed</strong> means the Bag after fetching the Items in <code>fetch.txt</code>, if present.</li>
</ul>
</li>
</ul>
<p>Note that a RegularFile that is included through a fetch-reference has <strong>file-data-location</strong> different from its <a href="#item-location">file-location</a>.      </p>
<h4 id="local-file-uri">local-file-uri<a class="headerlink" href="#local-file-uri" title="Permanent link">&para;</a></h4>
<p>For RegularFile we define a local-file-uri. This may, but does not need to be resolvable through a web server.
It is intended to be used in <code>fetch.txt</code>, to obviate the need for storing the exact same file multiple times in the same 
BagStore.</p>
<ul>
<li><strong>local-file-uri</strong> = <code>http://localhost/&lt;file-id&gt;</code></li>
</ul>
<h2 id="operations">Operations<a class="headerlink" href="#operations" title="Permanent link">&para;</a></h2>
<p>On a BagStore the following operations are allowed.</p>
<ul>
<li><code>ADD</code> - add a virtually-valid Bag to the BagStore.</li>
<li><code>ENUM</code> - enumerate all the Bags in the BagStore.</li>
<li><code>GET</code> - copy a Bag or an non-packaged RegularFile from the BagStore.</li>
<li><code>DEACTIVATE</code> - mark a Bag as inactive.</li>
<li><code>REACTIVATE</code> - reverse a deactivation.</li>
</ul>
<p>Note that this means that Bags are immutable. To support updates to Bags, add metadata that records
that a Bag is part of a sequence of Bags, that together form the revision history of one logical 
(and mutable) Bag. See for an example implementation the <a href="https://github.com/DANS-KNAW/easy-bag-index">easy-bag-index</a> project.</p>
<p>The <code>DEACTIVATE</code> operation marks a Bag as inactive. This involves marking the Bag directory as hidden
by prepending its name with a dot. Note that this operation does not require copying or modifying any
File data. The only "file" that is modified is the directory containing the Bag. On some file systems
this may still require write-privileges on the bag-base-dir.</p>
<h3 id="extension">Extension<a class="headerlink" href="#extension" title="Permanent link">&para;</a></h3>
<p>Some use cases may require bag data to be deleted, for example for legal reasons. For those special cases, an
extra operation is defined:</p>
<ul>
<li><code>ERASE</code> (optional) - erase the contents of a particular Bag <strong>payload</strong> File, and update the corresponding
  entries in any affected payload manifests accordingly.</li>
</ul>
<h2 id="compatibility-with-archival-resource-keys">Compatibility with Archival Resource Keys<a class="headerlink" href="#compatibility-with-archival-resource-keys" title="Permanent link">&para;</a></h2>
<p>Although item-ids are not Archival Resource Keys (<a href="http://n2t.net/e/arkspec.txt">ARK</a>s) by themselves, they can be used to mint ones. All that is
needed is an ARK "Name Assigning Authority Number" (NAAN). Optionally, a "Name Mapping Authority Hostport" (NMAH) can 
be provided to resolve ARKs over http. </p>
<h3 id="minting-an-ark-using-an-item-id">Minting an ARK using an item-id<a class="headerlink" href="#minting-an-ark-using-an-item-id" title="Permanent link">&para;</a></h3>
<p>An ARK has the following general form:</p>
<div class="codehilite"><pre><span></span><code>[http://NMAH/]ark:/NAAN/Name[Qualifier]
</code></pre></div>

<p>To mint your ARK you need to do the following substitutions in this template:</p>
<ul>
<li>Your NAAN for the string <code>NAAN</code>.</li>
<li>If you want to instantiate the optional NMAH-prefix: your NMAH for the string <code>NMAH</code>.</li>
<li>The item-id for the string <code>Name[Qualifier]</code>. </li>
<li>The <code>bag-id</code> part of the item-id fulfills the role of <code>Name</code>.</li>
<li>if the Item is a File, then te part <code>/percent-encoded-segments(&lt;path-in-bag&gt;)</code> fulfills the role of <code>Qualifier</code>.</li>
</ul>
<p>Note that the definition of <a href="#item-id"><code>percent-encoded-segments</code></a> ensures that the resulting string is a syntactically valid ARK and that it 
can be used without problems as part of an HTTP URL. The characters that can appear unencoded (the alphanumericals and underscore):</p>
<ul>
<li>all are part of the ARK character repertoire and (except <code>/</code>) have no special semantics in ARK;</li>
<li>the <code>/</code> is used as a hierarchical delimiter, and therefore has the semantics required by ARK;</li>
<li>all are member of the set of <a href="https://tools.ietf.org/html/rfc3986#section-2.3">URI unreserved characters</a> and thus have no special semantics in a URI.</li>
</ul>
<h3 id="getting-an-item-id-from-an-ark">Getting an item-id from an ARK<a class="headerlink" href="#getting-an-item-id-from-an-ark" title="Permanent link">&para;</a></h3>
<p>The ARKs you have minted as described above, you can easily convert back to item-ids.</p>
<ol>
<li>Normalize the ARK following the procedure described in section "2.7 Normalization and Lexical Equivalence" of the 
   <a href="http://n2t.net/e/arkspec.txt">ARK</a> specification.</li>
<li>Insert hyphens in the UUID part so that it conforms to the canonical textual representation of a UUID.</li>
</ol>
<p>With the item-id you can then calculate the item-location to retrieve the actual data.</p>
<h2 id="technical-considerations">Technical considerations<a class="headerlink" href="#technical-considerations" title="Permanent link">&para;</a></h2>
<h3 id="slashing-the-bag-id">Slashing the bag-id<a class="headerlink" href="#slashing-the-bag-id" title="Permanent link">&para;</a></h3>
<p>The rationale for this is that some file systems suffer a performance loss when a directory gets overfull. By distributing the
contents of the BagStore over subdirectories this problem is avoided. How deep to make the directory tree depends on the
number of (expected) Bags. However, note that it is relatively easy to change this later on, with a series of move operations.
In most (all?) file systems this means no data needs to be actually copied if the BagStore is contained in a single 
storage volume.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Manual" class="md-flex md-footer-nav__link md-footer-nav__link--prev head-type" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                Manual
              </span>
            </div>
          </a>
        
        
          <a href="../tutorial/" title="Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--next head-type" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                Tutorial
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        <div>
          
          powered by
          <a href="https://www.mkdocs.org">MkDocs</a>
          and
          <a href="https://squidfunk.github.io/mkdocs-material/">
            Material for MkDocs</a>
          customised by
          <a href="https://github.com/Dans-labs">Dans-labs</a>
        </div>
      </div>
      <div class="md-footer-dans">
  <div>DANS is an institute of KNAW and NWO</div>
  <div>
    <a href="https://dans.knaw.nl/en" title="Data Archiving and Networked Services (DANS)"><img class="md-footer-dans__img" src="../assets/images/DANS.gif" height="50"></a>
    <a target="_blank" href="https://www.knaw.nl/en"><img src="../assets/images/knaw.png" height="50"></a>
    <a target="_blank" href="https://www.nwo.nl/en"><img src="../assets/images/nwo.png" height="50"></a>
  </div>
  <div><i>Driven by data</i></div>
</div>
      
  <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
  <style>.md-footer-social__desc{font-family:"Open Sans",sans-serif;-webkit-font-smoothing:auto}</style>
  <ul class="md-footer-social">
    
    <li class="md-footer-social__li">
      <a href="http://eepurl.com/dvnr8D" class="md-footer-social__link fa fa-envelope-square">
        <span class="md-footer-social__desc">Newsletter</span>
      </a>
    </li>
    
    <li class="md-footer-social__li">
      <a href="https://twitter.com/DANSKNAW" class="md-footer-social__link fa fa-twitter-square">
        <span class="md-footer-social__desc">Twitter</span>
      </a>
    </li>
    
    <li class="md-footer-social__li">
      <a href="https://www.youtube.com/user/DANSDataArchiving" class="md-footer-social__link fa fa-youtube-square">
        <span class="md-footer-social__desc">YouTube</span>
      </a>
    </li>
    
    <li class="md-footer-social__li">
      <a href="https://www.linkedin.com/company/dans" class="md-footer-social__link fa fa-linkedin-square">
        <span class="md-footer-social__desc">LinkedIn</span>
      </a>
    </li>
    

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.43c0530e.js"></script>
      
      <script>app.initialize({version:"1.2.3",url:{base:".."}})</script>
      
    
  </body>
</html>